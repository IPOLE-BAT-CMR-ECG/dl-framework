
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="A pipeline for ECG and CMR deep learning">
      
      
      
      
        <link rel="prev" href="../data-management/">
      
      
        <link rel="next" href="../../models/architectures/">
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.5.49">
    
    
      
        <title>Preprocessing Pipeline - Aether</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.6f8fc17f.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#data-preprocessing-pipeline" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Aether" class="md-header__button md-logo" aria-label="Aether" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Aether
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Preprocessing Pipeline
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
          <a href="javascript:void(0)" class="md-search__icon md-icon" title="Share" aria-label="Share" data-clipboard data-clipboard-text="" data-md-component="search-share" tabindex="-1">
            
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91s2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08"/></svg>
          </a>
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://gitlab.fhnw.ch/ipole-bat/projection" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    Gitlab
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Aether" class="md-nav__button md-logo" aria-label="Aether" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Aether
  </label>
  
    <div class="md-nav__source">
      <a href="https://gitlab.fhnw.ch/ipole-bat/projection" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    Gitlab
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Getting Started
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Getting Started
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../getting-started/installation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Installation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../getting-started/configuration/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Configuration
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Data Pipeline
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Data Pipeline
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../datasets/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Dataset Integration
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../data-management/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Data Management
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Preprocessing Pipeline
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Preprocessing Pipeline
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#overview" class="md-nav__link">
    <span class="md-ellipsis">
      Overview
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pipeline-stages" class="md-nav__link">
    <span class="md-ellipsis">
      Pipeline Stages
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Pipeline Stages">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#stage-1-data-loading-validation" class="md-nav__link">
    <span class="md-ellipsis">
      Stage 1: Data Loading &amp; Validation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#stage-2-preprocessing" class="md-nav__link">
    <span class="md-ellipsis">
      Stage 2: Preprocessing
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Stage 2: Preprocessing">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cmr-processing-steps" class="md-nav__link">
    <span class="md-ellipsis">
      CMR Processing Steps
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ecg-processing-steps" class="md-nav__link">
    <span class="md-ellipsis">
      ECG Processing Steps
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#stage-3-dataset-creation" class="md-nav__link">
    <span class="md-ellipsis">
      Stage 3: Dataset Creation
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#usage" class="md-nav__link">
    <span class="md-ellipsis">
      Usage
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Usage">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#stage-1-data-preprocessing" class="md-nav__link">
    <span class="md-ellipsis">
      Stage 1: Data Preprocessing
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Stage 1: Data Preprocessing">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.data.preprocessing.main" class="md-nav__link">
    <span class="md-ellipsis">
      main
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.data.preprocessing.main.process_dataset" class="md-nav__link">
    <span class="md-ellipsis">
      process_dataset
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#getting-started" class="md-nav__link">
    <span class="md-ellipsis">
      Getting Started
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#common-configuration-options" class="md-nav__link">
    <span class="md-ellipsis">
      Common Configuration Options
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#modality-specific-options" class="md-nav__link">
    <span class="md-ellipsis">
      Modality-Specific Options
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Modality-Specific Options">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cmr-processing" class="md-nav__link">
    <span class="md-ellipsis">
      CMR Processing
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ecg-processing" class="md-nav__link">
    <span class="md-ellipsis">
      ECG Processing
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#monitoring-and-debugging" class="md-nav__link">
    <span class="md-ellipsis">
      Monitoring and Debugging
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#stage-2-dataset-partitioning" class="md-nav__link">
    <span class="md-ellipsis">
      Stage 2: Dataset Partitioning
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Stage 2: Dataset Partitioning">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.data.partitioning" class="md-nav__link">
    <span class="md-ellipsis">
      partitioning
    </span>
  </a>
  
    <nav class="md-nav" aria-label="partitioning">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.data.partitioning.DatasetSplit" class="md-nav__link">
    <span class="md-ellipsis">
      DatasetSplit
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.data.partitioning.PartitioningConfig" class="md-nav__link">
    <span class="md-ellipsis">
      PartitioningConfig
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.data.partitioning.create_splits" class="md-nav__link">
    <span class="md-ellipsis">
      create_splits
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#basic-usage" class="md-nav__link">
    <span class="md-ellipsis">
      Basic Usage
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#command-line-interface" class="md-nav__link">
    <span class="md-ellipsis">
      Command-Line Interface
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configuration-options" class="md-nav__link">
    <span class="md-ellipsis">
      Configuration Options
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#output-structure" class="md-nav__link">
    <span class="md-ellipsis">
      Output Structure
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#complete-pipeline-example" class="md-nav__link">
    <span class="md-ellipsis">
      Complete Pipeline Example
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Complete Pipeline Example">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#expected-directory-structure" class="md-nav__link">
    <span class="md-ellipsis">
      Expected Directory Structure
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Model Development
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Model Development
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../models/architectures/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Model Architectures
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../models/training/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Training Process
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4_3" >
        
          
          <label class="md-nav__link" for="__nav_4_3" id="__nav_4_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Analysis
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_3">
            <span class="md-nav__icon md-icon"></span>
            Analysis
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../models/analysis/model-artifacts/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Model Artifacts
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../models/analysis/embedding-visualization/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Embedding Visualization
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Development Guide
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Development Guide
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../development/tools/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Development Tools
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../development/ci-cd/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    CI/CD Pipeline
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../development/docker/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Docker Environment
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#overview" class="md-nav__link">
    <span class="md-ellipsis">
      Overview
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pipeline-stages" class="md-nav__link">
    <span class="md-ellipsis">
      Pipeline Stages
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Pipeline Stages">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#stage-1-data-loading-validation" class="md-nav__link">
    <span class="md-ellipsis">
      Stage 1: Data Loading &amp; Validation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#stage-2-preprocessing" class="md-nav__link">
    <span class="md-ellipsis">
      Stage 2: Preprocessing
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Stage 2: Preprocessing">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cmr-processing-steps" class="md-nav__link">
    <span class="md-ellipsis">
      CMR Processing Steps
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ecg-processing-steps" class="md-nav__link">
    <span class="md-ellipsis">
      ECG Processing Steps
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#stage-3-dataset-creation" class="md-nav__link">
    <span class="md-ellipsis">
      Stage 3: Dataset Creation
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#usage" class="md-nav__link">
    <span class="md-ellipsis">
      Usage
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Usage">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#stage-1-data-preprocessing" class="md-nav__link">
    <span class="md-ellipsis">
      Stage 1: Data Preprocessing
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Stage 1: Data Preprocessing">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.data.preprocessing.main" class="md-nav__link">
    <span class="md-ellipsis">
      main
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.data.preprocessing.main.process_dataset" class="md-nav__link">
    <span class="md-ellipsis">
      process_dataset
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#getting-started" class="md-nav__link">
    <span class="md-ellipsis">
      Getting Started
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#common-configuration-options" class="md-nav__link">
    <span class="md-ellipsis">
      Common Configuration Options
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#modality-specific-options" class="md-nav__link">
    <span class="md-ellipsis">
      Modality-Specific Options
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Modality-Specific Options">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cmr-processing" class="md-nav__link">
    <span class="md-ellipsis">
      CMR Processing
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ecg-processing" class="md-nav__link">
    <span class="md-ellipsis">
      ECG Processing
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#monitoring-and-debugging" class="md-nav__link">
    <span class="md-ellipsis">
      Monitoring and Debugging
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#stage-2-dataset-partitioning" class="md-nav__link">
    <span class="md-ellipsis">
      Stage 2: Dataset Partitioning
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Stage 2: Dataset Partitioning">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.data.partitioning" class="md-nav__link">
    <span class="md-ellipsis">
      partitioning
    </span>
  </a>
  
    <nav class="md-nav" aria-label="partitioning">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.data.partitioning.DatasetSplit" class="md-nav__link">
    <span class="md-ellipsis">
      DatasetSplit
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.data.partitioning.PartitioningConfig" class="md-nav__link">
    <span class="md-ellipsis">
      PartitioningConfig
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.data.partitioning.create_splits" class="md-nav__link">
    <span class="md-ellipsis">
      create_splits
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#basic-usage" class="md-nav__link">
    <span class="md-ellipsis">
      Basic Usage
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#command-line-interface" class="md-nav__link">
    <span class="md-ellipsis">
      Command-Line Interface
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configuration-options" class="md-nav__link">
    <span class="md-ellipsis">
      Configuration Options
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#output-structure" class="md-nav__link">
    <span class="md-ellipsis">
      Output Structure
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#complete-pipeline-example" class="md-nav__link">
    <span class="md-ellipsis">
      Complete Pipeline Example
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Complete Pipeline Example">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#expected-directory-structure" class="md-nav__link">
    <span class="md-ellipsis">
      Expected Directory Structure
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="data-preprocessing-pipeline">Data Preprocessing Pipeline<a class="headerlink" href="#data-preprocessing-pipeline" title="Permanent link">&para;</a></h1>
<h2 id="overview">Overview<a class="headerlink" href="#overview" title="Permanent link">&para;</a></h2>
<p>The preprocessing pipeline is a crucial component that transforms raw medical data into a standardized format suitable for model training and evaluation. It handles two main modalities:</p>
<ul>
<li><strong>CMR (Cardiac Magnetic Resonance)</strong>: Image preprocessing including resizing and normalization</li>
<li><strong>ECG (Electrocardiogram)</strong>: Signal processing including sequence standardization and various normalization strategies</li>
</ul>
<p>The following diagram illustrates the complete preprocessing workflow for both modalities, from raw data ingestion to the final preprocessed tensors that can be picked up by the training pipeline. Note that CMR and ECG data require different preprocessing approaches due to their distinct nature (image vs signal data) and are therefore processed and stored separately.</p>
<pre class="mermaid"><code>graph TD
    subgraph Input
        A1[Raw CMR Data] --&gt; B1
        A2[Raw ECG Data] --&gt; B2
    end

    subgraph Stage 1: Data Loading &amp; Validation
        B1[CMR Loading] --&gt; C1[3D Format Validation]
        B2[ECG Loading] --&gt; C2[2D Format Validation]
    end

    subgraph Stage 2: Preprocessing
        subgraph CMR Steps
            C1 --&gt; E1[Center Crop]
            E1 --&gt; F1[Channel First]
            F1 --&gt; G1[Normalize]
        end

        subgraph ECG Steps
            C2 --&gt; E2[Clean NaN]
            E2 --&gt; F2[Clip Outliers]
            F2 --&gt; G2[Baseline Correction]
            G2 --&gt; H2[Normalize]
        end
    end

    subgraph Stage 3: Dataset Creation
        subgraph CMR Dataset
            G1 --&gt; I1[CMR Data]
            I1 --&gt; J1[Train Split]
            I1 --&gt; J2[Val Split]
            I1 --&gt; J3[Test Split]
        end

        subgraph ECG Dataset
            H2 --&gt; I2[ECG Data]
            I2 --&gt; K1[Train Split]
            I2 --&gt; K2[Val Split]
            I2 --&gt; K3[Test Split]
        end

        subgraph Disk Storage
            J1 --&gt; L1[train_split.pt]
            J2 --&gt; L2[val_split.pt]
            J3 --&gt; L3[test_split.pt]
            K1 --&gt; M1[train_split.pt]
            K2 --&gt; M2[val_split.pt]
            K3 --&gt; M3[test_split.pt]
        end
    end

    L1 &amp; M1 -.-&gt; N[Training Pipeline]
    L2 &amp; M2 -.-&gt; N
    L3 &amp; M3 -.-&gt; N

    style Input fill:#e6f3ff,stroke:#4a90e2
    style N fill:#f0fff0,stroke:#27ae60</code></pre>
<h2 id="pipeline-stages">Pipeline Stages<a class="headerlink" href="#pipeline-stages" title="Permanent link">&para;</a></h2>
<h3 id="stage-1-data-loading-validation">Stage 1: Data Loading &amp; Validation<a class="headerlink" href="#stage-1-data-loading-validation" title="Permanent link">&para;</a></h3>
<p>Each modality undergoes initial validation to ensure data integrity:</p>
<ul>
<li><strong>CMR Data</strong>: </li>
<li>Validates 3D format (height × width × 3 slices)</li>
<li>Checks for expected dimensionality and slice count</li>
<li>
<p>Ensures data consistency across samples</p>
</li>
<li>
<p><strong>ECG Data</strong>:</p>
</li>
<li>Validates 2D format (12 leads × samples)</li>
<li>Verifies the presence of all 12 ECG leads</li>
<li>Checks signal length (expected: 5000 samples at 500Hz)</li>
</ul>
<h3 id="stage-2-preprocessing">Stage 2: Preprocessing<a class="headerlink" href="#stage-2-preprocessing" title="Permanent link">&para;</a></h3>
<h4 id="cmr-processing-steps">CMR Processing Steps<a class="headerlink" href="#cmr-processing-steps" title="Permanent link">&para;</a></h4>
<ol>
<li>
<p><strong>Center Crop</strong>: </p>
<ul>
<li>Standardizes image size to 210×210 pixels</li>
<li>Centers the heart in the frame using center crop/pad operations</li>
</ul>
</li>
<li>
<p><strong>Channel First</strong>: </p>
<ul>
<li>Transposes data to PyTorch format (3×210×210)</li>
<li>Arranges slices as channels for model input</li>
</ul>
</li>
<li>
<p><strong>Normalize</strong>: </p>
<ul>
<li>Scales pixel intensities to [0,1] range per slice</li>
<li>Enhances contrast and standardizes input range</li>
</ul>
</li>
</ol>
<h4 id="ecg-processing-steps">ECG Processing Steps<a class="headerlink" href="#ecg-processing-steps" title="Permanent link">&para;</a></h4>
<ol>
<li>
<p><strong>Clean NaN</strong>: </p>
<ul>
<li>Replaces NaN values with appropriate numerical values</li>
<li>Ensures signal continuity</li>
</ul>
</li>
<li>
<p><strong>Clip Outliers</strong>: </p>
<ul>
<li>Removes extreme values beyond ±4 standard deviations</li>
<li>Reduces impact of artifacts and noise</li>
</ul>
</li>
<li>
<p><strong>Baseline Correction</strong>: </p>
<ul>
<li>Applies Asymmetric Least Squares Smoothing</li>
<li>Removes baseline wander while preserving signal peaks</li>
<li>Uses optimized parameters (λ=1e7, p=0.3, iterations=5)</li>
</ul>
</li>
<li>
<p><strong>Normalize</strong>: </p>
<ul>
<li>Applies group-wise normalization</li>
<li>Groups leads into anatomical sets [1-3, 4-6, 7-12]</li>
<li>Standardizes signal amplitude across lead groups</li>
</ul>
</li>
</ol>
<h3 id="stage-3-dataset-creation">Stage 3: Dataset Creation<a class="headerlink" href="#stage-3-dataset-creation" title="Permanent link">&para;</a></h3>
<p>The preprocessed data can be organized into either standard train/val/test splits or k-fold cross-validation splits:</p>
<ol>
<li>
<p><strong>Standard Split Creation</strong>:</p>
<ul>
<li>Data is split while maintaining patient-level separation</li>
<li>Each modality maintains its own splits</li>
<li>Default split ratios: 80% train, 10% validation, 10% test</li>
<li>Storage format:
    <div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a>train_split.pt
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>val_split.pt
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>test_split.pt
</code></pre></div></li>
</ul>
</li>
<li>
<p><strong>K-Fold Cross-Validation</strong>:</p>
<ul>
<li>Supports stratified k-fold partitioning for robust model evaluation</li>
<li>Maintains class balance across folds</li>
<li>Each fold creates train and validation splits</li>
<li>Storage format for k folds:
    <div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a>fold_1_train_split.pt, fold_1_val_split.pt
<a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a>fold_2_train_split.pt, fold_2_val_split.pt
<a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a>...
<a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a>fold_k_train_split.pt, fold_k_val_split.pt
</code></pre></div></li>
</ul>
</li>
</ol>
<p>To create k-fold splits, use the partitioning script with the following options:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a>python<span class="w"> </span>src/data/partitioning.py<span class="w"> </span><span class="se">\</span>
<a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a><span class="w">    </span>--split_type<span class="w"> </span>stratified_kfold<span class="w"> </span><span class="se">\</span>
<a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a><span class="w">    </span>--n_folds<span class="w"> </span><span class="m">5</span><span class="w"> </span><span class="se">\</span>
<a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a><span class="w">    </span>--output_dir<span class="w"> </span>path/to/output
</code></pre></div>
<p>For running experiments with k-fold cross-validation, Hydra sweeps are used:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="c1"># Run all folds</span>
<a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a>python<span class="w"> </span>train.py<span class="w"> </span><span class="nv">experiment</span><span class="o">=</span>fine_tuning/cmr_acdc_cv<span class="w"> </span><span class="c1"># multirun is defined in the experiment config</span>
<a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a>
<a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a><span class="c1"># Run specific folds</span>
<a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a>python<span class="w"> </span>train.py<span class="w"> </span><span class="nv">experiment</span><span class="o">=</span>fine_tuning/cmr_acdc_cv<span class="w"> </span>hydra.sweeper.params.+fold<span class="o">=</span><span class="m">1</span>,3,5
</code></pre></div>
<p>The cross-validation configuration automatically:
- Runs the experiment for each fold
- Uses the appropriate train/val splits for each fold
- Maintains consistent data loading and augmentation across folds</p>
<h2 id="usage">Usage<a class="headerlink" href="#usage" title="Permanent link">&para;</a></h2>
<p>The preprocessing pipeline can be run using the main script:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a>python<span class="w"> </span>src/data/preprocessing/main.py<span class="w"> </span>--config-name<span class="w"> </span>preprocess
</code></pre></div>
<p>For configuration options and customization, refer to the <a href="../../getting-started/configuration/">Configuration Guide</a>.</p>
<h3 id="stage-1-data-preprocessing">Stage 1: Data Preprocessing<a class="headerlink" href="#stage-1-data-preprocessing" title="Permanent link">&para;</a></h3>
<p>The preprocessing script (<code>src/data/preprocessing/main.py</code>) provides a unified interface for handling different medical imaging modalities. It's designed to be:</p>
<ul>
<li><strong>Modality-Agnostic</strong>: Common interface for both CMR and ECG data</li>
<li><strong>Efficient</strong>: Supports parallel processing for large datasets</li>
<li><strong>Robust</strong>: Includes data validation and comprehensive error handling</li>
<li><strong>Flexible</strong>: Configurable preprocessing parameters per modality</li>
<li><strong>Maintainable</strong>: Detailed logging and progress tracking</li>
</ul>


<div class="doc doc-object doc-module">



<a id="src.data.preprocessing.main"></a>
    <div class="doc doc-contents first">








  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h4 id="src.data.preprocessing.main.process_dataset" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">process_dataset</span><span class="p">(</span><span class="n">args</span><span class="p">)</span></code>

<a href="#src.data.preprocessing.main.process_dataset" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

        <p>Process a single dataset identified by a unique key.</p>

            <details class="quote">
              <summary>Source code in <code>src/data/preprocessing/main.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-118">118</a></span>
<span class="normal"><a href="#__codelineno-0-119">119</a></span>
<span class="normal"><a href="#__codelineno-0-120">120</a></span>
<span class="normal"><a href="#__codelineno-0-121">121</a></span>
<span class="normal"><a href="#__codelineno-0-122">122</a></span>
<span class="normal"><a href="#__codelineno-0-123">123</a></span>
<span class="normal"><a href="#__codelineno-0-124">124</a></span>
<span class="normal"><a href="#__codelineno-0-125">125</a></span>
<span class="normal"><a href="#__codelineno-0-126">126</a></span>
<span class="normal"><a href="#__codelineno-0-127">127</a></span>
<span class="normal"><a href="#__codelineno-0-128">128</a></span>
<span class="normal"><a href="#__codelineno-0-129">129</a></span>
<span class="normal"><a href="#__codelineno-0-130">130</a></span>
<span class="normal"><a href="#__codelineno-0-131">131</a></span>
<span class="normal"><a href="#__codelineno-0-132">132</a></span>
<span class="normal"><a href="#__codelineno-0-133">133</a></span>
<span class="normal"><a href="#__codelineno-0-134">134</a></span>
<span class="normal"><a href="#__codelineno-0-135">135</a></span>
<span class="normal"><a href="#__codelineno-0-136">136</a></span>
<span class="normal"><a href="#__codelineno-0-137">137</a></span>
<span class="normal"><a href="#__codelineno-0-138">138</a></span>
<span class="normal"><a href="#__codelineno-0-139">139</a></span>
<span class="normal"><a href="#__codelineno-0-140">140</a></span>
<span class="normal"><a href="#__codelineno-0-141">141</a></span>
<span class="normal"><a href="#__codelineno-0-142">142</a></span>
<span class="normal"><a href="#__codelineno-0-143">143</a></span>
<span class="normal"><a href="#__codelineno-0-144">144</a></span>
<span class="normal"><a href="#__codelineno-0-145">145</a></span>
<span class="normal"><a href="#__codelineno-0-146">146</a></span>
<span class="normal"><a href="#__codelineno-0-147">147</a></span>
<span class="normal"><a href="#__codelineno-0-148">148</a></span>
<span class="normal"><a href="#__codelineno-0-149">149</a></span>
<span class="normal"><a href="#__codelineno-0-150">150</a></span>
<span class="normal"><a href="#__codelineno-0-151">151</a></span>
<span class="normal"><a href="#__codelineno-0-152">152</a></span>
<span class="normal"><a href="#__codelineno-0-153">153</a></span>
<span class="normal"><a href="#__codelineno-0-154">154</a></span>
<span class="normal"><a href="#__codelineno-0-155">155</a></span>
<span class="normal"><a href="#__codelineno-0-156">156</a></span>
<span class="normal"><a href="#__codelineno-0-157">157</a></span>
<span class="normal"><a href="#__codelineno-0-158">158</a></span>
<span class="normal"><a href="#__codelineno-0-159">159</a></span>
<span class="normal"><a href="#__codelineno-0-160">160</a></span>
<span class="normal"><a href="#__codelineno-0-161">161</a></span>
<span class="normal"><a href="#__codelineno-0-162">162</a></span>
<span class="normal"><a href="#__codelineno-0-163">163</a></span>
<span class="normal"><a href="#__codelineno-0-164">164</a></span>
<span class="normal"><a href="#__codelineno-0-165">165</a></span>
<span class="normal"><a href="#__codelineno-0-166">166</a></span>
<span class="normal"><a href="#__codelineno-0-167">167</a></span>
<span class="normal"><a href="#__codelineno-0-168">168</a></span>
<span class="normal"><a href="#__codelineno-0-169">169</a></span>
<span class="normal"><a href="#__codelineno-0-170">170</a></span>
<span class="normal"><a href="#__codelineno-0-171">171</a></span>
<span class="normal"><a href="#__codelineno-0-172">172</a></span>
<span class="normal"><a href="#__codelineno-0-173">173</a></span>
<span class="normal"><a href="#__codelineno-0-174">174</a></span>
<span class="normal"><a href="#__codelineno-0-175">175</a></span>
<span class="normal"><a href="#__codelineno-0-176">176</a></span>
<span class="normal"><a href="#__codelineno-0-177">177</a></span>
<span class="normal"><a href="#__codelineno-0-178">178</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-118" name="__codelineno-0-118"></a><span class="k">def</span> <span class="nf">process_dataset</span><span class="p">(</span><span class="n">args</span><span class="p">:</span> <span class="n">argparse</span><span class="o">.</span><span class="n">Namespace</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-119" name="__codelineno-0-119"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-120" name="__codelineno-0-120"></a><span class="sd">    Process a single dataset identified by a unique key.</span>
<a id="__codelineno-0-121" name="__codelineno-0-121"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-122" name="__codelineno-0-122"></a>    <span class="n">abs_data_root</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">data_root</span><span class="p">)</span><span class="o">.</span><span class="n">absolute</span><span class="p">()</span>
<a id="__codelineno-0-123" name="__codelineno-0-123"></a>
<a id="__codelineno-0-124" name="__codelineno-0-124"></a>    <span class="n">available_datasets</span> <span class="o">=</span> <span class="n">RawDatasetRegistry</span><span class="o">.</span><span class="n">list_datasets</span><span class="p">()</span>
<a id="__codelineno-0-125" name="__codelineno-0-125"></a>    <span class="n">modality_found</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-126" name="__codelineno-0-126"></a>
<a id="__codelineno-0-127" name="__codelineno-0-127"></a>    <span class="k">for</span> <span class="n">modality</span><span class="p">,</span> <span class="n">datasets</span> <span class="ow">in</span> <span class="n">available_datasets</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
<a id="__codelineno-0-128" name="__codelineno-0-128"></a>        <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">dataset</span> <span class="ow">in</span> <span class="n">datasets</span><span class="p">:</span>
<a id="__codelineno-0-129" name="__codelineno-0-129"></a>            <span class="n">modality_found</span> <span class="o">=</span> <span class="n">modality</span>
<a id="__codelineno-0-130" name="__codelineno-0-130"></a>            <span class="k">break</span>
<a id="__codelineno-0-131" name="__codelineno-0-131"></a>
<a id="__codelineno-0-132" name="__codelineno-0-132"></a>    <span class="k">if</span> <span class="n">modality_found</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-133" name="__codelineno-0-133"></a>        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Dataset key &#39;</span><span class="si">%s</span><span class="s2">&#39; not found.&quot;</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">dataset</span><span class="p">)</span>
<a id="__codelineno-0-134" name="__codelineno-0-134"></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Available datasets:&quot;</span><span class="p">)</span>
<a id="__codelineno-0-135" name="__codelineno-0-135"></a>        <span class="k">for</span> <span class="n">modality</span><span class="p">,</span> <span class="n">datasets</span> <span class="ow">in</span> <span class="n">available_datasets</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
<a id="__codelineno-0-136" name="__codelineno-0-136"></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">:&quot;</span><span class="p">,</span> <span class="n">modality</span><span class="o">.</span><span class="n">upper</span><span class="p">())</span>
<a id="__codelineno-0-137" name="__codelineno-0-137"></a>            <span class="k">for</span> <span class="n">ds</span> <span class="ow">in</span> <span class="n">datasets</span><span class="p">:</span>
<a id="__codelineno-0-138" name="__codelineno-0-138"></a>                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;  - </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">ds</span><span class="p">)</span>
<a id="__codelineno-0-139" name="__codelineno-0-139"></a>        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-140" name="__codelineno-0-140"></a>
<a id="__codelineno-0-141" name="__codelineno-0-141"></a>    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
<a id="__codelineno-0-142" name="__codelineno-0-142"></a>        <span class="s2">&quot;Processing dataset &#39;</span><span class="si">%s</span><span class="s2">&#39; for modality &#39;</span><span class="si">%s</span><span class="s2">&#39;.&quot;</span><span class="p">,</span>
<a id="__codelineno-0-143" name="__codelineno-0-143"></a>        <span class="n">args</span><span class="o">.</span><span class="n">dataset</span><span class="p">,</span>
<a id="__codelineno-0-144" name="__codelineno-0-144"></a>        <span class="n">modality_found</span><span class="o">.</span><span class="n">upper</span><span class="p">(),</span>
<a id="__codelineno-0-145" name="__codelineno-0-145"></a>    <span class="p">)</span>
<a id="__codelineno-0-146" name="__codelineno-0-146"></a>    <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-147" name="__codelineno-0-147"></a>        <span class="n">raw_data_class</span> <span class="o">=</span> <span class="n">RawDatasetRegistry</span><span class="o">.</span><span class="n">get_handler</span><span class="p">(</span><span class="n">modality_found</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">dataset</span><span class="p">)</span>
<a id="__codelineno-0-148" name="__codelineno-0-148"></a>        <span class="n">raw_data</span> <span class="o">=</span> <span class="n">raw_data_class</span><span class="p">(</span><span class="n">data_root</span><span class="o">=</span><span class="n">abs_data_root</span><span class="p">)</span>
<a id="__codelineno-0-149" name="__codelineno-0-149"></a>        <span class="n">raw_data</span><span class="o">.</span><span class="n">verify_data</span><span class="p">()</span>
<a id="__codelineno-0-150" name="__codelineno-0-150"></a>
<a id="__codelineno-0-151" name="__codelineno-0-151"></a>        <span class="k">if</span> <span class="n">modality_found</span> <span class="o">==</span> <span class="s2">&quot;ecg&quot;</span><span class="p">:</span>
<a id="__codelineno-0-152" name="__codelineno-0-152"></a>            <span class="n">preprocessor</span> <span class="o">=</span> <span class="n">ECGPreprocessor</span><span class="p">(</span>
<a id="__codelineno-0-153" name="__codelineno-0-153"></a>                <span class="n">raw_data_handler</span><span class="o">=</span><span class="n">raw_data</span><span class="p">,</span>
<a id="__codelineno-0-154" name="__codelineno-0-154"></a>                <span class="n">sequence_length</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">sequence_length</span><span class="p">,</span>
<a id="__codelineno-0-155" name="__codelineno-0-155"></a>                <span class="n">normalize_mode</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">normalize_mode</span><span class="p">,</span>
<a id="__codelineno-0-156" name="__codelineno-0-156"></a>                <span class="n">max_workers</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">max_workers</span><span class="p">,</span>
<a id="__codelineno-0-157" name="__codelineno-0-157"></a>                <span class="n">force_restart</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">force_restart</span><span class="p">,</span>
<a id="__codelineno-0-158" name="__codelineno-0-158"></a>                <span class="n">clean_interim</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">clean_interim</span><span class="p">,</span>
<a id="__codelineno-0-159" name="__codelineno-0-159"></a>            <span class="p">)</span>
<a id="__codelineno-0-160" name="__codelineno-0-160"></a>        <span class="k">elif</span> <span class="n">modality_found</span> <span class="o">==</span> <span class="s2">&quot;cmr&quot;</span><span class="p">:</span>
<a id="__codelineno-0-161" name="__codelineno-0-161"></a>            <span class="n">preprocessor</span> <span class="o">=</span> <span class="n">CMRPreprocessor</span><span class="p">(</span>
<a id="__codelineno-0-162" name="__codelineno-0-162"></a>                <span class="n">raw_data_handler</span><span class="o">=</span><span class="n">raw_data</span><span class="p">,</span>
<a id="__codelineno-0-163" name="__codelineno-0-163"></a>                <span class="n">image_size</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">image_size</span><span class="p">,</span>
<a id="__codelineno-0-164" name="__codelineno-0-164"></a>                <span class="n">normalize</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">normalize</span><span class="p">,</span>
<a id="__codelineno-0-165" name="__codelineno-0-165"></a>                <span class="n">max_workers</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">max_workers</span><span class="p">,</span>
<a id="__codelineno-0-166" name="__codelineno-0-166"></a>                <span class="n">force_restart</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">force_restart</span><span class="p">,</span>
<a id="__codelineno-0-167" name="__codelineno-0-167"></a>                <span class="n">clean_interim</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">clean_interim</span><span class="p">,</span>
<a id="__codelineno-0-168" name="__codelineno-0-168"></a>            <span class="p">)</span>
<a id="__codelineno-0-169" name="__codelineno-0-169"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-170" name="__codelineno-0-170"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unknown modality: </span><span class="si">{</span><span class="n">modality_found</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-171" name="__codelineno-0-171"></a>
<a id="__codelineno-0-172" name="__codelineno-0-172"></a>        <span class="n">preprocessor</span><span class="o">.</span><span class="n">preprocess_all</span><span class="p">()</span>
<a id="__codelineno-0-173" name="__codelineno-0-173"></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Finished processing dataset &#39;</span><span class="si">%s</span><span class="s2">&#39;.&quot;</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">dataset</span><span class="p">)</span>
<a id="__codelineno-0-174" name="__codelineno-0-174"></a>    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-0-175" name="__codelineno-0-175"></a>        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
<a id="__codelineno-0-176" name="__codelineno-0-176"></a>            <span class="s2">&quot;Error processing dataset &#39;</span><span class="si">%s</span><span class="s2">&#39;: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">dataset</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span>
<a id="__codelineno-0-177" name="__codelineno-0-177"></a>        <span class="p">)</span>
<a id="__codelineno-0-178" name="__codelineno-0-178"></a>        <span class="k">raise</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div><h4 id="getting-started">Getting Started<a class="headerlink" href="#getting-started" title="Permanent link">&para;</a></h4>
<p>The basic workflow involves selecting a dataset to process and configuring the preprocessing parameters:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="c1"># Basic usage</span>
<a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a>rye<span class="w"> </span>run<span class="w"> </span>preprocess<span class="w"> </span>--data_root<span class="w"> </span>data<span class="w"> </span>--dataset<span class="w"> </span>acdc<span class="w"> </span>--max_workers<span class="w"> </span><span class="m">5</span>
</code></pre></div>
<h4 id="common-configuration-options">Common Configuration Options<a class="headerlink" href="#common-configuration-options" title="Permanent link">&para;</a></h4>
<p>These options apply to all datasets regardless of modality:</p>
<ul>
<li><code>--data_root</code>: Root directory containing raw data</li>
<li><code>--dataset</code>: Unique dataset key to process (e.g., 'acdc', 'ptbxl')</li>
<li><code>--max_workers</code>: Number of workers for parallel processing (optional)</li>
<li><code>--force_restart</code>: Force restart preprocessing from scratch</li>
<li><code>--clean_interim</code>: Clean interim directory after processing</li>
</ul>
<h4 id="modality-specific-options">Modality-Specific Options<a class="headerlink" href="#modality-specific-options" title="Permanent link">&para;</a></h4>
<p>Different modalities require different preprocessing steps and parameters:</p>
<h5 id="cmr-processing">CMR Processing<a class="headerlink" href="#cmr-processing" title="Permanent link">&para;</a></h5>
<div class="highlight"><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a>rye<span class="w"> </span>run<span class="w"> </span>preprocess<span class="w"> </span><span class="se">\</span>
<a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a><span class="w">    </span>--data_root<span class="w"> </span>data<span class="w"> </span><span class="se">\</span>
<a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a><span class="w">    </span>--dataset<span class="w"> </span>acdc<span class="w"> </span><span class="se">\</span>
<a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a><span class="w">    </span>--image_size<span class="w"> </span><span class="m">256</span><span class="w"> </span><span class="se">\</span>
<a id="__codelineno-6-5" name="__codelineno-6-5" href="#__codelineno-6-5"></a><span class="w">    </span>--normalize<span class="w"> </span><span class="se">\</span>
<a id="__codelineno-6-6" name="__codelineno-6-6" href="#__codelineno-6-6"></a><span class="w">    </span>--max_workers<span class="w"> </span><span class="m">5</span>
</code></pre></div>
<p><strong>Parameters</strong>:
- <code>--image_size</code>: Target size for image resizing (default: 256)
- <code>--normalize</code>: Apply intensity normalization (default: True)</p>
<h5 id="ecg-processing">ECG Processing<a class="headerlink" href="#ecg-processing" title="Permanent link">&para;</a></h5>
<div class="highlight"><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a>rye<span class="w"> </span>run<span class="w"> </span>preprocess<span class="w"> </span><span class="se">\</span>
<a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a><span class="w">    </span>--data_root<span class="w"> </span>data<span class="w"> </span><span class="se">\</span>
<a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a><span class="w">    </span>--dataset<span class="w"> </span>ptbxl<span class="w"> </span><span class="se">\</span>
<a id="__codelineno-7-4" name="__codelineno-7-4" href="#__codelineno-7-4"></a><span class="w">    </span>--sequence_length<span class="w"> </span><span class="m">5000</span><span class="w"> </span><span class="se">\</span>
<a id="__codelineno-7-5" name="__codelineno-7-5" href="#__codelineno-7-5"></a><span class="w">    </span>--normalize_mode<span class="w"> </span>group_wise<span class="w"> </span><span class="se">\</span>
<a id="__codelineno-7-6" name="__codelineno-7-6" href="#__codelineno-7-6"></a><span class="w">    </span>--max_workers<span class="w"> </span><span class="m">5</span>
</code></pre></div>
<p><strong>Parameters</strong>:
- <code>--sequence_length</code>: Desired sequence length (default: 5000)
- <code>--normalize_mode</code>: Normalization strategy (choices: sample_wise, channel_wise, group_wise)</p>
<h4 id="monitoring-and-debugging">Monitoring and Debugging<a class="headerlink" href="#monitoring-and-debugging" title="Permanent link">&para;</a></h4>
<p>The preprocessing script maintains detailed logs to help track progress and debug issues:</p>
<ul>
<li><strong>Log Location</strong>: <code>logs/preprocessing.log</code></li>
<li><strong>Log Features</strong>:<ul>
<li>Rotating file handler (max 1MB per file, 5 backup files)</li>
<li>Console output for immediate feedback</li>
<li>Debug-level logging to file</li>
<li>Detailed error tracking and stack traces</li>
</ul>
</li>
</ul>
<h3 id="stage-2-dataset-partitioning">Stage 2: Dataset Partitioning<a class="headerlink" href="#stage-2-dataset-partitioning" title="Permanent link">&para;</a></h3>
<p>After preprocessing, the data needs to be split into training, validation, and test sets. The partitioning script (<code>src/data/partitioning.py</code>) provides:</p>
<ul>
<li>Random and stratified splitting strategies</li>
<li>Configurable split sizes</li>
<li>Optional train subset creation</li>
<li>Automatic sanity checks for data leakage</li>
<li>Comprehensive split statistics</li>
</ul>


<div class="doc doc-object doc-module">



<h4 id="src.data.partitioning" class="doc doc-heading">
            <code>src.data.partitioning</code>


<a href="#src.data.partitioning" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents first">








  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h5 id="src.data.partitioning.DatasetSplit" class="doc doc-heading">
            <code>DatasetSplit</code>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

<a href="#src.data.partitioning.DatasetSplit" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">


        <p>Container for split data and metadata.</p>






              <details class="quote">
                <summary>Source code in <code>src/data/partitioning.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-34">34</a></span>
<span class="normal"><a href="#__codelineno-0-35">35</a></span>
<span class="normal"><a href="#__codelineno-0-36">36</a></span>
<span class="normal"><a href="#__codelineno-0-37">37</a></span>
<span class="normal"><a href="#__codelineno-0-38">38</a></span>
<span class="normal"><a href="#__codelineno-0-39">39</a></span>
<span class="normal"><a href="#__codelineno-0-40">40</a></span>
<span class="normal"><a href="#__codelineno-0-41">41</a></span>
<span class="normal"><a href="#__codelineno-0-42">42</a></span>
<span class="normal"><a href="#__codelineno-0-43">43</a></span>
<span class="normal"><a href="#__codelineno-0-44">44</a></span>
<span class="normal"><a href="#__codelineno-0-45">45</a></span>
<span class="normal"><a href="#__codelineno-0-46">46</a></span>
<span class="normal"><a href="#__codelineno-0-47">47</a></span>
<span class="normal"><a href="#__codelineno-0-48">48</a></span>
<span class="normal"><a href="#__codelineno-0-49">49</a></span>
<span class="normal"><a href="#__codelineno-0-50">50</a></span>
<span class="normal"><a href="#__codelineno-0-51">51</a></span>
<span class="normal"><a href="#__codelineno-0-52">52</a></span>
<span class="normal"><a href="#__codelineno-0-53">53</a></span>
<span class="normal"><a href="#__codelineno-0-54">54</a></span>
<span class="normal"><a href="#__codelineno-0-55">55</a></span>
<span class="normal"><a href="#__codelineno-0-56">56</a></span>
<span class="normal"><a href="#__codelineno-0-57">57</a></span>
<span class="normal"><a href="#__codelineno-0-58">58</a></span>
<span class="normal"><a href="#__codelineno-0-59">59</a></span>
<span class="normal"><a href="#__codelineno-0-60">60</a></span>
<span class="normal"><a href="#__codelineno-0-61">61</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-34" name="__codelineno-0-34"></a><span class="nd">@dataclass</span>
<a id="__codelineno-0-35" name="__codelineno-0-35"></a><span class="k">class</span> <span class="nc">DatasetSplit</span><span class="p">:</span>
<a id="__codelineno-0-36" name="__codelineno-0-36"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Container for split data and metadata.&quot;&quot;&quot;</span>
<a id="__codelineno-0-37" name="__codelineno-0-37"></a>
<a id="__codelineno-0-38" name="__codelineno-0-38"></a>    <span class="n">data</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span>
<a id="__codelineno-0-39" name="__codelineno-0-39"></a>    <span class="n">targets</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]]</span>
<a id="__codelineno-0-40" name="__codelineno-0-40"></a>    <span class="n">record_ids</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
<a id="__codelineno-0-41" name="__codelineno-0-41"></a>
<a id="__codelineno-0-42" name="__codelineno-0-42"></a>    <span class="k">def</span> <span class="nf">to_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-43" name="__codelineno-0-43"></a>        <span class="k">return</span> <span class="p">{</span>
<a id="__codelineno-0-44" name="__codelineno-0-44"></a>            <span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span>
<a id="__codelineno-0-45" name="__codelineno-0-45"></a>            <span class="s2">&quot;targets&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">targets</span><span class="p">,</span>
<a id="__codelineno-0-46" name="__codelineno-0-46"></a>            <span class="s2">&quot;record_ids&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">record_ids</span><span class="p">,</span>
<a id="__codelineno-0-47" name="__codelineno-0-47"></a>        <span class="p">}</span>
<a id="__codelineno-0-48" name="__codelineno-0-48"></a>
<a id="__codelineno-0-49" name="__codelineno-0-49"></a>    <span class="nd">@staticmethod</span>
<a id="__codelineno-0-50" name="__codelineno-0-50"></a>    <span class="k">def</span> <span class="nf">from_dict</span><span class="p">(</span><span class="n">data_dict</span><span class="p">):</span>
<a id="__codelineno-0-51" name="__codelineno-0-51"></a>        <span class="k">return</span> <span class="n">DatasetSplit</span><span class="p">(</span>
<a id="__codelineno-0-52" name="__codelineno-0-52"></a>            <span class="n">data</span><span class="o">=</span><span class="n">data_dict</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">],</span>
<a id="__codelineno-0-53" name="__codelineno-0-53"></a>            <span class="n">targets</span><span class="o">=</span><span class="n">data_dict</span><span class="p">[</span><span class="s2">&quot;targets&quot;</span><span class="p">],</span>
<a id="__codelineno-0-54" name="__codelineno-0-54"></a>            <span class="n">record_ids</span><span class="o">=</span><span class="n">data_dict</span><span class="p">[</span><span class="s2">&quot;record_ids&quot;</span><span class="p">],</span>
<a id="__codelineno-0-55" name="__codelineno-0-55"></a>        <span class="p">)</span>
<a id="__codelineno-0-56" name="__codelineno-0-56"></a>
<a id="__codelineno-0-57" name="__codelineno-0-57"></a>    <span class="k">def</span> <span class="nf">__post_init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-58" name="__codelineno-0-58"></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">targets</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">record_ids</span><span class="p">):</span>
<a id="__codelineno-0-59" name="__codelineno-0-59"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Targets and record IDs must have the same length&quot;</span><span class="p">)</span>
<a id="__codelineno-0-60" name="__codelineno-0-60"></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">targets</span><span class="p">):</span>
<a id="__codelineno-0-61" name="__codelineno-0-61"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Data and targets must have the same length&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h5 id="src.data.partitioning.PartitioningConfig" class="doc doc-heading">
            <code>PartitioningConfig</code>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

<a href="#src.data.partitioning.PartitioningConfig" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">


        <p>Configuration for data partitioning.</p>






              <details class="quote">
                <summary>Source code in <code>src/data/partitioning.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-64">64</a></span>
<span class="normal"><a href="#__codelineno-0-65">65</a></span>
<span class="normal"><a href="#__codelineno-0-66">66</a></span>
<span class="normal"><a href="#__codelineno-0-67">67</a></span>
<span class="normal"><a href="#__codelineno-0-68">68</a></span>
<span class="normal"><a href="#__codelineno-0-69">69</a></span>
<span class="normal"><a href="#__codelineno-0-70">70</a></span>
<span class="normal"><a href="#__codelineno-0-71">71</a></span>
<span class="normal"><a href="#__codelineno-0-72">72</a></span>
<span class="normal"><a href="#__codelineno-0-73">73</a></span>
<span class="normal"><a href="#__codelineno-0-74">74</a></span>
<span class="normal"><a href="#__codelineno-0-75">75</a></span>
<span class="normal"><a href="#__codelineno-0-76">76</a></span>
<span class="normal"><a href="#__codelineno-0-77">77</a></span>
<span class="normal"><a href="#__codelineno-0-78">78</a></span>
<span class="normal"><a href="#__codelineno-0-79">79</a></span>
<span class="normal"><a href="#__codelineno-0-80">80</a></span>
<span class="normal"><a href="#__codelineno-0-81">81</a></span>
<span class="normal"><a href="#__codelineno-0-82">82</a></span>
<span class="normal"><a href="#__codelineno-0-83">83</a></span>
<span class="normal"><a href="#__codelineno-0-84">84</a></span>
<span class="normal"><a href="#__codelineno-0-85">85</a></span>
<span class="normal"><a href="#__codelineno-0-86">86</a></span>
<span class="normal"><a href="#__codelineno-0-87">87</a></span>
<span class="normal"><a href="#__codelineno-0-88">88</a></span>
<span class="normal"><a href="#__codelineno-0-89">89</a></span>
<span class="normal"><a href="#__codelineno-0-90">90</a></span>
<span class="normal"><a href="#__codelineno-0-91">91</a></span>
<span class="normal"><a href="#__codelineno-0-92">92</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-64" name="__codelineno-0-64"></a><span class="nd">@dataclass</span>
<a id="__codelineno-0-65" name="__codelineno-0-65"></a><span class="k">class</span> <span class="nc">PartitioningConfig</span><span class="p">:</span>
<a id="__codelineno-0-66" name="__codelineno-0-66"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Configuration for data partitioning.&quot;&quot;&quot;</span>
<a id="__codelineno-0-67" name="__codelineno-0-67"></a>
<a id="__codelineno-0-68" name="__codelineno-0-68"></a>    <span class="n">split_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;random&quot;</span>  <span class="c1"># One of: random, stratified, kfold, stratified_kfold</span>
<a id="__codelineno-0-69" name="__codelineno-0-69"></a>    <span class="n">val_size</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.1</span>
<a id="__codelineno-0-70" name="__codelineno-0-70"></a>    <span class="n">test_size</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.1</span>
<a id="__codelineno-0-71" name="__codelineno-0-71"></a>    <span class="n">train_subsample_size</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-72" name="__codelineno-0-72"></a>    <span class="n">random_seed</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1337</span>
<a id="__codelineno-0-73" name="__codelineno-0-73"></a>    <span class="n">output_dir</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Path</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-74" name="__codelineno-0-74"></a>    <span class="n">n_folds</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span>  <span class="c1"># Number of folds for k-fold cross validation</span>
<a id="__codelineno-0-75" name="__codelineno-0-75"></a>
<a id="__codelineno-0-76" name="__codelineno-0-76"></a>    <span class="k">def</span> <span class="nf">validate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-77" name="__codelineno-0-77"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">train_subsample_size</span> <span class="ow">and</span> <span class="ow">not</span> <span class="mi">0</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">train_subsample_size</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-0-78" name="__codelineno-0-78"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Train subsample size must be between 0 and 1.&quot;</span><span class="p">)</span>
<a id="__codelineno-0-79" name="__codelineno-0-79"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">split_type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;random&quot;</span><span class="p">,</span> <span class="s2">&quot;stratified&quot;</span><span class="p">,</span> <span class="s2">&quot;kfold&quot;</span><span class="p">,</span> <span class="s2">&quot;stratified_kfold&quot;</span><span class="p">]:</span>
<a id="__codelineno-0-80" name="__codelineno-0-80"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid split type: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">split_type</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-81" name="__codelineno-0-81"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">split_type</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;kfold&quot;</span><span class="p">,</span> <span class="s2">&quot;stratified_kfold&quot;</span><span class="p">]</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_folds</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
<a id="__codelineno-0-82" name="__codelineno-0-82"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Number of folds must be at least 2&quot;</span><span class="p">)</span>
<a id="__codelineno-0-83" name="__codelineno-0-83"></a>
<a id="__codelineno-0-84" name="__codelineno-0-84"></a>    <span class="k">def</span> <span class="nf">to_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-85" name="__codelineno-0-85"></a>        <span class="k">return</span> <span class="p">{</span>
<a id="__codelineno-0-86" name="__codelineno-0-86"></a>            <span class="s2">&quot;split_type&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">split_type</span><span class="p">,</span>
<a id="__codelineno-0-87" name="__codelineno-0-87"></a>            <span class="s2">&quot;val_size&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">val_size</span><span class="p">,</span>
<a id="__codelineno-0-88" name="__codelineno-0-88"></a>            <span class="s2">&quot;test_size&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">test_size</span><span class="p">,</span>
<a id="__codelineno-0-89" name="__codelineno-0-89"></a>            <span class="s2">&quot;train_subsample_size&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">train_subsample_size</span><span class="p">,</span>
<a id="__codelineno-0-90" name="__codelineno-0-90"></a>            <span class="s2">&quot;random_seed&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">random_seed</span><span class="p">,</span>
<a id="__codelineno-0-91" name="__codelineno-0-91"></a>            <span class="s2">&quot;n_folds&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_folds</span><span class="p">,</span>
<a id="__codelineno-0-92" name="__codelineno-0-92"></a>        <span class="p">}</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>


<div class="doc doc-object doc-function">


<h5 id="src.data.partitioning.create_splits" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">create_splits</span><span class="p">(</span><span class="n">sample_ids</span><span class="p">,</span> <span class="n">config</span><span class="p">,</span> <span class="n">targets</span><span class="p">)</span></code>

<a href="#src.data.partitioning.create_splits" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Create dataset splits based on configuration.</p>

            <details class="quote">
              <summary>Source code in <code>src/data/partitioning.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-141">141</a></span>
<span class="normal"><a href="#__codelineno-0-142">142</a></span>
<span class="normal"><a href="#__codelineno-0-143">143</a></span>
<span class="normal"><a href="#__codelineno-0-144">144</a></span>
<span class="normal"><a href="#__codelineno-0-145">145</a></span>
<span class="normal"><a href="#__codelineno-0-146">146</a></span>
<span class="normal"><a href="#__codelineno-0-147">147</a></span>
<span class="normal"><a href="#__codelineno-0-148">148</a></span>
<span class="normal"><a href="#__codelineno-0-149">149</a></span>
<span class="normal"><a href="#__codelineno-0-150">150</a></span>
<span class="normal"><a href="#__codelineno-0-151">151</a></span>
<span class="normal"><a href="#__codelineno-0-152">152</a></span>
<span class="normal"><a href="#__codelineno-0-153">153</a></span>
<span class="normal"><a href="#__codelineno-0-154">154</a></span>
<span class="normal"><a href="#__codelineno-0-155">155</a></span>
<span class="normal"><a href="#__codelineno-0-156">156</a></span>
<span class="normal"><a href="#__codelineno-0-157">157</a></span>
<span class="normal"><a href="#__codelineno-0-158">158</a></span>
<span class="normal"><a href="#__codelineno-0-159">159</a></span>
<span class="normal"><a href="#__codelineno-0-160">160</a></span>
<span class="normal"><a href="#__codelineno-0-161">161</a></span>
<span class="normal"><a href="#__codelineno-0-162">162</a></span>
<span class="normal"><a href="#__codelineno-0-163">163</a></span>
<span class="normal"><a href="#__codelineno-0-164">164</a></span>
<span class="normal"><a href="#__codelineno-0-165">165</a></span>
<span class="normal"><a href="#__codelineno-0-166">166</a></span>
<span class="normal"><a href="#__codelineno-0-167">167</a></span>
<span class="normal"><a href="#__codelineno-0-168">168</a></span>
<span class="normal"><a href="#__codelineno-0-169">169</a></span>
<span class="normal"><a href="#__codelineno-0-170">170</a></span>
<span class="normal"><a href="#__codelineno-0-171">171</a></span>
<span class="normal"><a href="#__codelineno-0-172">172</a></span>
<span class="normal"><a href="#__codelineno-0-173">173</a></span>
<span class="normal"><a href="#__codelineno-0-174">174</a></span>
<span class="normal"><a href="#__codelineno-0-175">175</a></span>
<span class="normal"><a href="#__codelineno-0-176">176</a></span>
<span class="normal"><a href="#__codelineno-0-177">177</a></span>
<span class="normal"><a href="#__codelineno-0-178">178</a></span>
<span class="normal"><a href="#__codelineno-0-179">179</a></span>
<span class="normal"><a href="#__codelineno-0-180">180</a></span>
<span class="normal"><a href="#__codelineno-0-181">181</a></span>
<span class="normal"><a href="#__codelineno-0-182">182</a></span>
<span class="normal"><a href="#__codelineno-0-183">183</a></span>
<span class="normal"><a href="#__codelineno-0-184">184</a></span>
<span class="normal"><a href="#__codelineno-0-185">185</a></span>
<span class="normal"><a href="#__codelineno-0-186">186</a></span>
<span class="normal"><a href="#__codelineno-0-187">187</a></span>
<span class="normal"><a href="#__codelineno-0-188">188</a></span>
<span class="normal"><a href="#__codelineno-0-189">189</a></span>
<span class="normal"><a href="#__codelineno-0-190">190</a></span>
<span class="normal"><a href="#__codelineno-0-191">191</a></span>
<span class="normal"><a href="#__codelineno-0-192">192</a></span>
<span class="normal"><a href="#__codelineno-0-193">193</a></span>
<span class="normal"><a href="#__codelineno-0-194">194</a></span>
<span class="normal"><a href="#__codelineno-0-195">195</a></span>
<span class="normal"><a href="#__codelineno-0-196">196</a></span>
<span class="normal"><a href="#__codelineno-0-197">197</a></span>
<span class="normal"><a href="#__codelineno-0-198">198</a></span>
<span class="normal"><a href="#__codelineno-0-199">199</a></span>
<span class="normal"><a href="#__codelineno-0-200">200</a></span>
<span class="normal"><a href="#__codelineno-0-201">201</a></span>
<span class="normal"><a href="#__codelineno-0-202">202</a></span>
<span class="normal"><a href="#__codelineno-0-203">203</a></span>
<span class="normal"><a href="#__codelineno-0-204">204</a></span>
<span class="normal"><a href="#__codelineno-0-205">205</a></span>
<span class="normal"><a href="#__codelineno-0-206">206</a></span>
<span class="normal"><a href="#__codelineno-0-207">207</a></span>
<span class="normal"><a href="#__codelineno-0-208">208</a></span>
<span class="normal"><a href="#__codelineno-0-209">209</a></span>
<span class="normal"><a href="#__codelineno-0-210">210</a></span>
<span class="normal"><a href="#__codelineno-0-211">211</a></span>
<span class="normal"><a href="#__codelineno-0-212">212</a></span>
<span class="normal"><a href="#__codelineno-0-213">213</a></span>
<span class="normal"><a href="#__codelineno-0-214">214</a></span>
<span class="normal"><a href="#__codelineno-0-215">215</a></span>
<span class="normal"><a href="#__codelineno-0-216">216</a></span>
<span class="normal"><a href="#__codelineno-0-217">217</a></span>
<span class="normal"><a href="#__codelineno-0-218">218</a></span>
<span class="normal"><a href="#__codelineno-0-219">219</a></span>
<span class="normal"><a href="#__codelineno-0-220">220</a></span>
<span class="normal"><a href="#__codelineno-0-221">221</a></span>
<span class="normal"><a href="#__codelineno-0-222">222</a></span>
<span class="normal"><a href="#__codelineno-0-223">223</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-141" name="__codelineno-0-141"></a><span class="k">def</span> <span class="nf">create_splits</span><span class="p">(</span>
<a id="__codelineno-0-142" name="__codelineno-0-142"></a>    <span class="n">sample_ids</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
<a id="__codelineno-0-143" name="__codelineno-0-143"></a>    <span class="n">config</span><span class="p">:</span> <span class="n">PartitioningConfig</span><span class="p">,</span>
<a id="__codelineno-0-144" name="__codelineno-0-144"></a>    <span class="n">targets</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Any</span><span class="p">],</span>
<a id="__codelineno-0-145" name="__codelineno-0-145"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]:</span>
<a id="__codelineno-0-146" name="__codelineno-0-146"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Create dataset splits based on configuration.&quot;&quot;&quot;</span>
<a id="__codelineno-0-147" name="__codelineno-0-147"></a>    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Creating </span><span class="si">{</span><span class="n">config</span><span class="o">.</span><span class="n">split_type</span><span class="si">}</span><span class="s2"> splits&quot;</span><span class="p">)</span>
<a id="__codelineno-0-148" name="__codelineno-0-148"></a>
<a id="__codelineno-0-149" name="__codelineno-0-149"></a>    <span class="k">if</span> <span class="n">config</span><span class="o">.</span><span class="n">split_type</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;kfold&quot;</span><span class="p">,</span> <span class="s2">&quot;stratified_kfold&quot;</span><span class="p">]:</span>
<a id="__codelineno-0-150" name="__codelineno-0-150"></a>        <span class="k">if</span> <span class="n">config</span><span class="o">.</span><span class="n">split_type</span> <span class="o">==</span> <span class="s2">&quot;kfold&quot;</span><span class="p">:</span>
<a id="__codelineno-0-151" name="__codelineno-0-151"></a>            <span class="n">kf</span> <span class="o">=</span> <span class="n">KFold</span><span class="p">(</span>
<a id="__codelineno-0-152" name="__codelineno-0-152"></a>                <span class="n">n_splits</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">n_folds</span><span class="p">,</span> <span class="n">shuffle</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">random_seed</span>
<a id="__codelineno-0-153" name="__codelineno-0-153"></a>            <span class="p">)</span>
<a id="__codelineno-0-154" name="__codelineno-0-154"></a>            <span class="n">fold_indices</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">kf</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">sample_ids</span><span class="p">))</span>
<a id="__codelineno-0-155" name="__codelineno-0-155"></a>        <span class="k">else</span><span class="p">:</span>  <span class="c1"># stratified_kfold</span>
<a id="__codelineno-0-156" name="__codelineno-0-156"></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">targets</span><span class="p">:</span>
<a id="__codelineno-0-157" name="__codelineno-0-157"></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Targets required for stratified k-fold split&quot;</span><span class="p">)</span>
<a id="__codelineno-0-158" name="__codelineno-0-158"></a>
<a id="__codelineno-0-159" name="__codelineno-0-159"></a>            <span class="n">composite_labels</span> <span class="o">=</span> <span class="n">create_composite_labels</span><span class="p">(</span><span class="n">targets</span><span class="p">)</span>
<a id="__codelineno-0-160" name="__codelineno-0-160"></a>            <span class="n">kf</span> <span class="o">=</span> <span class="n">StratifiedKFold</span><span class="p">(</span>
<a id="__codelineno-0-161" name="__codelineno-0-161"></a>                <span class="n">n_splits</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">n_folds</span><span class="p">,</span> <span class="n">shuffle</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">random_seed</span>
<a id="__codelineno-0-162" name="__codelineno-0-162"></a>            <span class="p">)</span>
<a id="__codelineno-0-163" name="__codelineno-0-163"></a>            <span class="n">fold_indices</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">kf</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">sample_ids</span><span class="p">,</span> <span class="n">composite_labels</span><span class="p">))</span>
<a id="__codelineno-0-164" name="__codelineno-0-164"></a>
<a id="__codelineno-0-165" name="__codelineno-0-165"></a>        <span class="c1"># Create splits dictionary with folds</span>
<a id="__codelineno-0-166" name="__codelineno-0-166"></a>        <span class="n">splits</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-0-167" name="__codelineno-0-167"></a>        <span class="k">for</span> <span class="n">fold_idx</span><span class="p">,</span> <span class="p">(</span><span class="n">train_idx</span><span class="p">,</span> <span class="n">val_idx</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">fold_indices</span><span class="p">):</span>
<a id="__codelineno-0-168" name="__codelineno-0-168"></a>            <span class="n">fold_num</span> <span class="o">=</span> <span class="n">fold_idx</span> <span class="o">+</span> <span class="mi">1</span>
<a id="__codelineno-0-169" name="__codelineno-0-169"></a>            <span class="n">splits</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;fold_</span><span class="si">{</span><span class="n">fold_num</span><span class="si">}</span><span class="s2">_train&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">sample_ids</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">train_idx</span><span class="p">]</span>
<a id="__codelineno-0-170" name="__codelineno-0-170"></a>            <span class="n">splits</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;fold_</span><span class="si">{</span><span class="n">fold_num</span><span class="si">}</span><span class="s2">_val&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">sample_ids</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">val_idx</span><span class="p">]</span>
<a id="__codelineno-0-171" name="__codelineno-0-171"></a>
<a id="__codelineno-0-172" name="__codelineno-0-172"></a>    <span class="k">elif</span> <span class="n">config</span><span class="o">.</span><span class="n">split_type</span> <span class="o">==</span> <span class="s2">&quot;random&quot;</span><span class="p">:</span>
<a id="__codelineno-0-173" name="__codelineno-0-173"></a>        <span class="n">train_val</span><span class="p">,</span> <span class="n">test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span>
<a id="__codelineno-0-174" name="__codelineno-0-174"></a>            <span class="n">sample_ids</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">test_size</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">random_seed</span>
<a id="__codelineno-0-175" name="__codelineno-0-175"></a>        <span class="p">)</span>
<a id="__codelineno-0-176" name="__codelineno-0-176"></a>        <span class="n">train</span><span class="p">,</span> <span class="n">val</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span>
<a id="__codelineno-0-177" name="__codelineno-0-177"></a>            <span class="n">train_val</span><span class="p">,</span>
<a id="__codelineno-0-178" name="__codelineno-0-178"></a>            <span class="n">test_size</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">val_size</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">config</span><span class="o">.</span><span class="n">test_size</span><span class="p">),</span>
<a id="__codelineno-0-179" name="__codelineno-0-179"></a>            <span class="n">random_state</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">random_seed</span><span class="p">,</span>
<a id="__codelineno-0-180" name="__codelineno-0-180"></a>        <span class="p">)</span>
<a id="__codelineno-0-181" name="__codelineno-0-181"></a>        <span class="n">splits</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;train&quot;</span><span class="p">:</span> <span class="n">train</span><span class="p">,</span> <span class="s2">&quot;val&quot;</span><span class="p">:</span> <span class="n">val</span><span class="p">,</span> <span class="s2">&quot;test&quot;</span><span class="p">:</span> <span class="n">test</span><span class="p">}</span>
<a id="__codelineno-0-182" name="__codelineno-0-182"></a>    <span class="k">elif</span> <span class="n">config</span><span class="o">.</span><span class="n">split_type</span> <span class="o">==</span> <span class="s2">&quot;stratified&quot;</span><span class="p">:</span>
<a id="__codelineno-0-183" name="__codelineno-0-183"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">targets</span><span class="p">:</span>
<a id="__codelineno-0-184" name="__codelineno-0-184"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Targets required for stratified split&quot;</span><span class="p">)</span>
<a id="__codelineno-0-185" name="__codelineno-0-185"></a>
<a id="__codelineno-0-186" name="__codelineno-0-186"></a>        <span class="n">composite_labels</span> <span class="o">=</span> <span class="n">create_composite_labels</span><span class="p">(</span><span class="n">targets</span><span class="p">)</span>
<a id="__codelineno-0-187" name="__codelineno-0-187"></a>
<a id="__codelineno-0-188" name="__codelineno-0-188"></a>        <span class="c1"># First split: train_val vs test</span>
<a id="__codelineno-0-189" name="__codelineno-0-189"></a>        <span class="n">sss</span> <span class="o">=</span> <span class="n">StratifiedShuffleSplit</span><span class="p">(</span>
<a id="__codelineno-0-190" name="__codelineno-0-190"></a>            <span class="n">test_size</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">test_size</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">random_seed</span><span class="p">,</span> <span class="n">n_splits</span><span class="o">=</span><span class="mi">1</span>
<a id="__codelineno-0-191" name="__codelineno-0-191"></a>        <span class="p">)</span>
<a id="__codelineno-0-192" name="__codelineno-0-192"></a>        <span class="n">train_val_idx</span><span class="p">,</span> <span class="n">test_idx</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">sss</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">sample_ids</span><span class="p">,</span> <span class="n">composite_labels</span><span class="p">))</span>
<a id="__codelineno-0-193" name="__codelineno-0-193"></a>
<a id="__codelineno-0-194" name="__codelineno-0-194"></a>        <span class="c1"># Second split: train vs val</span>
<a id="__codelineno-0-195" name="__codelineno-0-195"></a>        <span class="n">train_val_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">sample_ids</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">train_val_idx</span><span class="p">]</span>
<a id="__codelineno-0-196" name="__codelineno-0-196"></a>        <span class="n">train_val_labels</span> <span class="o">=</span> <span class="p">[</span><span class="n">composite_labels</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">train_val_idx</span><span class="p">]</span>
<a id="__codelineno-0-197" name="__codelineno-0-197"></a>
<a id="__codelineno-0-198" name="__codelineno-0-198"></a>        <span class="n">sss_val</span> <span class="o">=</span> <span class="n">StratifiedShuffleSplit</span><span class="p">(</span>
<a id="__codelineno-0-199" name="__codelineno-0-199"></a>            <span class="n">test_size</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">val_size</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">config</span><span class="o">.</span><span class="n">test_size</span><span class="p">),</span>
<a id="__codelineno-0-200" name="__codelineno-0-200"></a>            <span class="n">random_state</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">random_seed</span><span class="p">,</span>
<a id="__codelineno-0-201" name="__codelineno-0-201"></a>            <span class="n">n_splits</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
<a id="__codelineno-0-202" name="__codelineno-0-202"></a>        <span class="p">)</span>
<a id="__codelineno-0-203" name="__codelineno-0-203"></a>        <span class="n">train_idx</span><span class="p">,</span> <span class="n">val_idx</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">sss_val</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">train_val_ids</span><span class="p">,</span> <span class="n">train_val_labels</span><span class="p">))</span>
<a id="__codelineno-0-204" name="__codelineno-0-204"></a>
<a id="__codelineno-0-205" name="__codelineno-0-205"></a>        <span class="n">splits</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-0-206" name="__codelineno-0-206"></a>            <span class="s2">&quot;train&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">train_val_ids</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">train_idx</span><span class="p">],</span>
<a id="__codelineno-0-207" name="__codelineno-0-207"></a>            <span class="s2">&quot;val&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">train_val_ids</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">val_idx</span><span class="p">],</span>
<a id="__codelineno-0-208" name="__codelineno-0-208"></a>            <span class="s2">&quot;test&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">sample_ids</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">test_idx</span><span class="p">],</span>
<a id="__codelineno-0-209" name="__codelineno-0-209"></a>        <span class="p">}</span>
<a id="__codelineno-0-210" name="__codelineno-0-210"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-211" name="__codelineno-0-211"></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid split type: </span><span class="si">{</span><span class="n">config</span><span class="o">.</span><span class="n">split_type</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-212" name="__codelineno-0-212"></a>
<a id="__codelineno-0-213" name="__codelineno-0-213"></a>    <span class="k">if</span> <span class="n">config</span><span class="o">.</span><span class="n">train_subsample_size</span> <span class="ow">and</span> <span class="n">config</span><span class="o">.</span><span class="n">split_type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span>
<a id="__codelineno-0-214" name="__codelineno-0-214"></a>        <span class="s2">&quot;kfold&quot;</span><span class="p">,</span>
<a id="__codelineno-0-215" name="__codelineno-0-215"></a>        <span class="s2">&quot;stratified_kfold&quot;</span><span class="p">,</span>
<a id="__codelineno-0-216" name="__codelineno-0-216"></a>    <span class="p">]:</span>
<a id="__codelineno-0-217" name="__codelineno-0-217"></a>        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Creating train subsample (</span><span class="si">{</span><span class="n">config</span><span class="o">.</span><span class="n">train_subsample_size</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
<a id="__codelineno-0-218" name="__codelineno-0-218"></a>        <span class="n">subsample_size</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">splits</span><span class="p">[</span><span class="s2">&quot;train&quot;</span><span class="p">])</span> <span class="o">*</span> <span class="n">config</span><span class="o">.</span><span class="n">train_subsample_size</span><span class="p">)</span>
<a id="__codelineno-0-219" name="__codelineno-0-219"></a>        <span class="n">splits</span><span class="p">[</span><span class="s2">&quot;train_subsample&quot;</span><span class="p">],</span> <span class="n">_</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span>
<a id="__codelineno-0-220" name="__codelineno-0-220"></a>            <span class="n">splits</span><span class="p">[</span><span class="s2">&quot;train&quot;</span><span class="p">],</span> <span class="n">train_size</span><span class="o">=</span><span class="n">subsample_size</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">random_seed</span>
<a id="__codelineno-0-221" name="__codelineno-0-221"></a>        <span class="p">)</span>
<a id="__codelineno-0-222" name="__codelineno-0-222"></a>
<a id="__codelineno-0-223" name="__codelineno-0-223"></a>    <span class="k">return</span> <span class="n">splits</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div><h4 id="basic-usage">Basic Usage<a class="headerlink" href="#basic-usage" title="Permanent link">&para;</a></h4>
<p>Here's how to create dataset splits programmatically:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a><span class="kn">from</span> <span class="nn">src.data.partitioning</span> <span class="kn">import</span> <span class="n">PartitioningConfig</span><span class="p">,</span> <span class="n">create_splits</span>
<a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a><span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
<a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a>
<a id="__codelineno-8-4" name="__codelineno-8-4" href="#__codelineno-8-4"></a><span class="c1"># Configure splitting</span>
<a id="__codelineno-8-5" name="__codelineno-8-5" href="#__codelineno-8-5"></a><span class="n">config</span> <span class="o">=</span> <span class="n">PartitioningConfig</span><span class="p">(</span>
<a id="__codelineno-8-6" name="__codelineno-8-6" href="#__codelineno-8-6"></a>    <span class="n">split_type</span><span class="o">=</span><span class="s2">&quot;random&quot;</span><span class="p">,</span>  <span class="c1"># or &quot;stratified&quot;</span>
<a id="__codelineno-8-7" name="__codelineno-8-7" href="#__codelineno-8-7"></a>    <span class="n">val_size</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span>
<a id="__codelineno-8-8" name="__codelineno-8-8" href="#__codelineno-8-8"></a>    <span class="n">test_size</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span>
<a id="__codelineno-8-9" name="__codelineno-8-9" href="#__codelineno-8-9"></a>    <span class="n">train_subsample_size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>  <span class="c1"># Optional: create smaller training subset</span>
<a id="__codelineno-8-10" name="__codelineno-8-10" href="#__codelineno-8-10"></a>    <span class="n">random_seed</span><span class="o">=</span><span class="mi">1337</span><span class="p">,</span>
<a id="__codelineno-8-11" name="__codelineno-8-11" href="#__codelineno-8-11"></a>    <span class="n">output_dir</span><span class="o">=</span><span class="n">Path</span><span class="p">(</span><span class="s2">&quot;data/processed/acdc&quot;</span><span class="p">)</span>
<a id="__codelineno-8-12" name="__codelineno-8-12" href="#__codelineno-8-12"></a><span class="p">)</span>
<a id="__codelineno-8-13" name="__codelineno-8-13" href="#__codelineno-8-13"></a>
<a id="__codelineno-8-14" name="__codelineno-8-14" href="#__codelineno-8-14"></a><span class="c1"># Create splits</span>
<a id="__codelineno-8-15" name="__codelineno-8-15" href="#__codelineno-8-15"></a><span class="n">splits</span> <span class="o">=</span> <span class="n">create_splits</span><span class="p">(</span>
<a id="__codelineno-8-16" name="__codelineno-8-16" href="#__codelineno-8-16"></a>    <span class="n">sample_ids</span><span class="o">=</span><span class="n">sample_ids</span><span class="p">,</span>
<a id="__codelineno-8-17" name="__codelineno-8-17" href="#__codelineno-8-17"></a>    <span class="n">config</span><span class="o">=</span><span class="n">config</span><span class="p">,</span>
<a id="__codelineno-8-18" name="__codelineno-8-18" href="#__codelineno-8-18"></a>    <span class="n">targets</span><span class="o">=</span><span class="n">targets</span>  <span class="c1"># Optional, required for stratified splits</span>
<a id="__codelineno-8-19" name="__codelineno-8-19" href="#__codelineno-8-19"></a><span class="p">)</span>
</code></pre></div>
<h4 id="command-line-interface">Command-Line Interface<a class="headerlink" href="#command-line-interface" title="Permanent link">&para;</a></h4>
<p>For command-line usage:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a><span class="c1"># Random split</span>
<a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a>rye<span class="w"> </span>run<span class="w"> </span>partition<span class="w"> </span><span class="se">\</span>
<a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a><span class="w">    </span>--data_dir<span class="w"> </span>data/interim/acdc<span class="w"> </span><span class="se">\</span>
<a id="__codelineno-9-4" name="__codelineno-9-4" href="#__codelineno-9-4"></a><span class="w">    </span>--output_dir<span class="w"> </span>data/processed/acdc<span class="w"> </span><span class="se">\</span>
<a id="__codelineno-9-5" name="__codelineno-9-5" href="#__codelineno-9-5"></a><span class="w">    </span>--split_type<span class="w"> </span>random
<a id="__codelineno-9-6" name="__codelineno-9-6" href="#__codelineno-9-6"></a>
<a id="__codelineno-9-7" name="__codelineno-9-7" href="#__codelineno-9-7"></a><span class="c1"># Stratified split (requires targets)</span>
<a id="__codelineno-9-8" name="__codelineno-9-8" href="#__codelineno-9-8"></a>rye<span class="w"> </span>run<span class="w"> </span>partition<span class="w"> </span><span class="se">\</span>
<a id="__codelineno-9-9" name="__codelineno-9-9" href="#__codelineno-9-9"></a><span class="w">    </span>--data_dir<span class="w"> </span>data/interim/acdc<span class="w"> </span><span class="se">\</span>
<a id="__codelineno-9-10" name="__codelineno-9-10" href="#__codelineno-9-10"></a><span class="w">    </span>--output_dir<span class="w"> </span>data/processed/acdc<span class="w"> </span><span class="se">\</span>
<a id="__codelineno-9-11" name="__codelineno-9-11" href="#__codelineno-9-11"></a><span class="w">    </span>--split_type<span class="w"> </span>stratified
</code></pre></div>
<h4 id="configuration-options">Configuration Options<a class="headerlink" href="#configuration-options" title="Permanent link">&para;</a></h4>
<ul>
<li><code>--split_type</code>: Type of split to create</li>
<li><code>random</code>: Simple random split</li>
<li><code>stratified</code>: Split preserving class distribution</li>
<li><code>--val_size</code>: Validation set size as fraction (default: 0.1)</li>
<li><code>--test_size</code>: Test set size as fraction (default: 0.1)</li>
<li><code>--train_subsample_size</code>: Optional size for train subset as fraction for faster debugging</li>
<li><code>--random_seed</code>: Random seed for reproducibility (default: 1337)</li>
</ul>
<h4 id="output-structure">Output Structure<a class="headerlink" href="#output-structure" title="Permanent link">&para;</a></h4>
<p>The partitioning script generates several output files:</p>
<ul>
<li><code>splits.json</code>: Contains the mapping of record IDs to each split</li>
<li><code>partitioning_cfg.json</code>: Records the configuration used for splitting</li>
<li><code>{split_name}_split.pt</code>: Tensor data files for each split (train/val/test)</li>
</ul>
<p>Each split file contains:
- Preprocessed data tensors
- Associated targets/labels
- Record IDs for traceability
- Metadata for reproduction</p>
<h2 id="complete-pipeline-example">Complete Pipeline Example<a class="headerlink" href="#complete-pipeline-example" title="Permanent link">&para;</a></h2>
<p>Here's a complete example showing how to preprocess and partition a CMR dataset:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a><span class="c1"># 1. Preprocess the raw data</span>
<a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a>rye<span class="w"> </span>run<span class="w"> </span>preprocess<span class="w"> </span><span class="se">\</span>
<a id="__codelineno-10-3" name="__codelineno-10-3" href="#__codelineno-10-3"></a><span class="w">    </span>--data_root<span class="w"> </span>data<span class="w"> </span><span class="se">\</span>
<a id="__codelineno-10-4" name="__codelineno-10-4" href="#__codelineno-10-4"></a><span class="w">    </span>--dataset<span class="w"> </span>acdc<span class="w"> </span><span class="se">\</span>
<a id="__codelineno-10-5" name="__codelineno-10-5" href="#__codelineno-10-5"></a><span class="w">    </span>--max_workers<span class="w"> </span><span class="m">5</span>
<a id="__codelineno-10-6" name="__codelineno-10-6" href="#__codelineno-10-6"></a>
<a id="__codelineno-10-7" name="__codelineno-10-7" href="#__codelineno-10-7"></a><span class="c1"># 2. Create dataset splits</span>
<a id="__codelineno-10-8" name="__codelineno-10-8" href="#__codelineno-10-8"></a>rye<span class="w"> </span>run<span class="w"> </span>partition<span class="w"> </span><span class="se">\</span>
<a id="__codelineno-10-9" name="__codelineno-10-9" href="#__codelineno-10-9"></a><span class="w">    </span>--data_dir<span class="w"> </span>data/interim/acdc<span class="w"> </span><span class="se">\</span>
<a id="__codelineno-10-10" name="__codelineno-10-10" href="#__codelineno-10-10"></a><span class="w">    </span>--output_dir<span class="w"> </span>data/processed/acdc<span class="w"> </span><span class="se">\</span>
<a id="__codelineno-10-11" name="__codelineno-10-11" href="#__codelineno-10-11"></a><span class="w">    </span>--split_type<span class="w"> </span>random
</code></pre></div>
<h3 id="expected-directory-structure">Expected Directory Structure<a class="headerlink" href="#expected-directory-structure" title="Permanent link">&para;</a></h3>
<p>After running the complete pipeline, your data directory should look like this:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a>data/
<a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a>├── raw/                            # Original raw data
<a id="__codelineno-11-3" name="__codelineno-11-3" href="#__codelineno-11-3"></a>│   └── acdc/                       # ACDC dataset raw files
<a id="__codelineno-11-4" name="__codelineno-11-4" href="#__codelineno-11-4"></a>│       ├── patient001/             # Patient-specific directories
<a id="__codelineno-11-5" name="__codelineno-11-5" href="#__codelineno-11-5"></a>│       ├── patient002/
<a id="__codelineno-11-6" name="__codelineno-11-6" href="#__codelineno-11-6"></a>│       └── ...
<a id="__codelineno-11-7" name="__codelineno-11-7" href="#__codelineno-11-7"></a>├── interim/                        # Preprocessed data
<a id="__codelineno-11-8" name="__codelineno-11-8" href="#__codelineno-11-8"></a>│   └── acdc/                       # ACDC preprocessed files
<a id="__codelineno-11-9" name="__codelineno-11-9" href="#__codelineno-11-9"></a>│       ├── patient001.pt           # Preprocessed patient data
<a id="__codelineno-11-10" name="__codelineno-11-10" href="#__codelineno-11-10"></a>│       ├── patient002.pt
<a id="__codelineno-11-11" name="__codelineno-11-11" href="#__codelineno-11-11"></a>│       └── ...
<a id="__codelineno-11-12" name="__codelineno-11-12" href="#__codelineno-11-12"></a>└── processed/                      # Final processed and split data
<a id="__codelineno-11-13" name="__codelineno-11-13" href="#__codelineno-11-13"></a>    └── acdc/                       # ACDC dataset splits
<a id="__codelineno-11-14" name="__codelineno-11-14" href="#__codelineno-11-14"></a>        ├── train_split.pt          # Training data
<a id="__codelineno-11-15" name="__codelineno-11-15" href="#__codelineno-11-15"></a>        ├── val_split.pt            # Validation data
<a id="__codelineno-11-16" name="__codelineno-11-16" href="#__codelineno-11-16"></a>        ├── test_split.pt           # Test data
<a id="__codelineno-11-17" name="__codelineno-11-17" href="#__codelineno-11-17"></a>        ├── splits.json             # Split configuration and indices
<a id="__codelineno-11-18" name="__codelineno-11-18" href="#__codelineno-11-18"></a>        └── partitioning_cfg.json   # Partitioning configuration
<a id="__codelineno-11-19" name="__codelineno-11-19" href="#__codelineno-11-19"></a>        └── metadata.db             # Record metadata
</code></pre></div>
<div class="admonition note">
<p class="admonition-title">Reproducibility with Weights &amp; Biases</p>
<p>When using Weights &amp; Biases logging during training, the splits configuration file (<code>splits.json</code>) is automatically uploaded as a W&amp;B artifact. This ensures:</p>
<ul>
<li>Complete reproducibility of dataset splits across runs</li>
<li>Easy tracking of which splits were used in each experiment</li>
<li>Ability to reuse exact splits for comparative experiments</li>
<li>Version control of dataset partitioning</li>
</ul>
<p>You can access these splits through the W&amp;B UI or programmatically using the W&amp;B API.</p>
</div>
<p>After all steps, your should be able to start training. See <a href="../../models/training/">Training Models</a> for more information.</p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.instant", "navigation.tracking", "navigation.sections", "navigation.expand", "navigation.top", "search.highlight", "search.share", "content.code.copy"], "search": "../../assets/javascripts/workers/search.6ce7567c.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.88dd0f4e.min.js"></script>
      
    
  </body>
</html>